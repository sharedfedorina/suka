const express = require('express');
const path = require('path');
const fs = require('fs');

const app = express();
const PORT = 6614;

// –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
app.set('view engine', 'ejs');
app.set('views', path.join(__dirname, 'views'));
app.use(express.static(path.join(__dirname, 'public')));
app.use(express.json());

// –¢–µ—Å—Ç–æ–≤—ñ –ª–æ–≥–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
console.log('\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
console.log('üöÄ –ö–û–ù–°–¢–†–£–ö–¢–û–† –õ–ï–ù–î–Ü–ù–ì–Ü–í - ET–ê–ü 2 –¢–ï–°–¢–£–í–ê–ù–ù–Ø');
console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

// –¢–ï–°–¢ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–∞–π–ª—ñ–≤
console.log('‚úì –¢–ï–°–¢ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—Ä–æ–µ–∫—Ç—É');
const requiredDirs = ['views', 'public', 'data'];
const requiredFiles = ['data/landing-data.json'];

requiredDirs.forEach(dir => {
  const fullPath = path.join(__dirname, dir);
  if (fs.existsSync(fullPath)) {
    console.log(`  ‚úÖ –ü–∞–ø–∫–∞ ${dir} —ñ—Å–Ω—É—î`);
  } else {
    console.log(`  ‚ùå –ü–∞–ø–∫–∞ ${dir} –ù–ï –∑–Ω–∞–π–¥–µ–Ω–∞`);
  }
});

requiredFiles.forEach(file => {
  const fullPath = path.join(__dirname, file);
  if (fs.existsSync(fullPath)) {
    console.log(`  ‚úÖ –§–∞–π–ª ${file} —ñ—Å–Ω—É—î`);
  } else {
    console.log(`  ‚ùå –§–∞–π–ª ${file} –ù–ï –∑–Ω–∞–π–¥–µ–Ω–∏–π`);
  }
});

// –¢–ï–°–¢ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ JSON
console.log('\n‚úì –¢–ï–°–¢ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ JSON –¥–∞–Ω–∏—Ö');
try {
  const dataPath = path.join(__dirname, 'data', 'landing-data.json');
  const rawData = fs.readFileSync(dataPath, 'utf-8');
  const data = JSON.parse(rawData);

  console.log(`  ‚úÖ JSON —É—Å–ø—ñ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–∏–π (${rawData.length} bytes)`);
  console.log(`  ‚úÖ –¢–æ–≤–∞—Ä—ñ–≤: ${data.products.items.length}`);
  console.log(`  ‚úÖ –ü–µ—Ä–µ–≤–∞–≥: ${data.advantages.length}`);
  console.log(`  ‚úÖ Brand: ${data.metadata.brand}`);
} catch (error) {
  console.log(`  ‚ùå –ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è JSON: ${error.message}`);
}

// –¢–ï–°–¢ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Express
console.log('\n‚úì –¢–ï–°–¢ 3: Express —Ç–∞ EJS');
console.log(`  ‚úÖ Express v${require('express/package.json').version}`);
console.log(`  ‚úÖ EJS v${require('ejs/package.json').version}`);

// –ú–ê–†–®–†–£–¢–ò

// GET / - –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —Ñ–æ—Ä–º–æ—é –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
app.get('/', (req, res) => {
  try {
    const dataPath = path.join(__dirname, 'data', 'landing-data.json');
    const defaultData = JSON.parse(fs.readFileSync(dataPath, 'utf-8'));

    res.send(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –õ–µ–Ω–¥—ñ–Ω–≥—ñ–≤</title>
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
          }
          .container { max-width: 1200px; margin: 0 auto; }
          .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
          }
          .header h1 { font-size: 2.5em; margin-bottom: 10px; }
          .header p { font-size: 1.1em; opacity: 0.9; }

          .tabs {
            display: flex;
            margin-bottom: 30px;
            gap: 10px;
          }
          .tab-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid transparent;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
          }
          .tab-btn.active {
            background: white;
            color: #667eea;
            border-color: #667eea;
          }
          .tab-btn:hover {
            background: rgba(255,255,255,0.3);
          }
          .tab-content { display: none; }
          .tab-content.active { display: block; }

          .content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }

          .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
          }

          .card h2 { color: #333; margin-bottom: 20px; font-size: 1.5em; }

          .form-group { margin-bottom: 15px; }
          .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
          }
          .form-group input,
          .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.95em;
          }
          .form-group textarea { resize: vertical; min-height: 100px; }

          .btn {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
          }
          .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
          }

          .btn-secondary {
            background: #6c757d;
            margin-right: 10px;
          }
          .btn-secondary:hover { background: #5a6268; }

          .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
          }
          .info-box p { color: #555; line-height: 1.6; }

          .route {
            background: #f0f0f0;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
          }

          @media (max-width: 768px) {
            .content { grid-template-columns: 1fr; }
          }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>üé® –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –õ–µ–Ω–¥—ñ–Ω–≥—ñ–≤</h1>
            <p>–ì–µ–Ω–µ—Ä—É–π—Ç–µ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ª–µ–Ω–¥—ñ–Ω–≥–∏ –∑ –≤–ª–∞—Å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏</p>
          </div>

          <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('easy')">üìù –ü—Ä–æ—Å—Ç–æ</button>
            <button class="tab-btn" onclick="switchTab('json')">üíª JSON</button>
            <button class="tab-btn" onclick="switchTab('info')">‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</button>
          </div>

          <div id="easy" class="tab-content active">
            <div class="card" style="grid-column: 1/-1;">
              <h2>‚ö° –ö–∞—Å—Ç–æ–º–Ω–∏–π –ª–µ–Ω–¥—ñ–Ω–≥ (–±–µ–∑ JSON!)</h2>
              <p style="color: #666; margin-bottom: 20px;">–ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –Ω–∏–∂—á–µ, —ñ –º–∏ –∑–≥–µ–Ω–µ—Ä—É—î–º–æ —Å–∞–π—Ç –∑–∞ –≤–∞—Å!</p>

              <form id="easyForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                  <label>üè¢ –ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó</label>
                  <input type="text" id="brand" value="Printex Pro" placeholder="–í–∞—à–∞ –∫–æ–º–ø–∞–Ω—ñ—è">
                </div>

                <div class="form-group">
                  <label>üì± –ó–∞–≥–æ–ª–æ–≤–æ–∫ (Hero)</label>
                  <input type="text" id="heroTitle" value="–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ 3D –ø—Ä–∏–Ω—Ç–µ—Ä–∏" placeholder="–û—Å–Ω–æ–≤–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫">
                </div>

                <div class="form-group">
                  <label>üí∞ –¶—ñ–Ω–∞ (–≤ –≥—Ä–Ω)</label>
                  <input type="text" id="price" value="8 500" placeholder="–¶—ñ–Ω–∞">
                </div>

                <div class="form-group">
                  <label>üì∏ –ì–µ—Ä–æ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (–ø–æ—Å–∏–ª–∞–Ω–Ω—è)</label>
                  <input type="text" id="heroImage" value="img/start/start-1.png" placeholder="https://...">
                </div>

                <div class="form-group">
                  <label>üé• –ü—Ä–æ–º–æ –≤—ñ–¥–µ–æ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ MP4)</label>
                  <input type="text" id="videoUrl" value="video/promo-1.mp4" placeholder="https://...">
                </div>

                <div class="form-group">
                  <label>üì∏ –ü—Ä–æ–º–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞</label>
                  <input type="text" id="videoThumbnail" value="img/promo/promo-1.jpg" placeholder="https://...">
                </div>

                <div class="form-group" style="grid-column: 1/-1;">
                  <label>‚ú® –ü–µ—Ä—à–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ (—Ç–µ–∫—Å—Ç)</label>
                  <input type="text" id="adv1" value="–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞" placeholder="–¢–µ–∫—Å—Ç –ø–µ—Ä–µ–≤–∞–≥–∏">
                </div>

                <div class="form-group" style="grid-column: 1/-1;">
                  <label>‚ú® –î—Ä—É–≥–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ (—Ç–µ–∫—Å—Ç)</label>
                  <input type="text" id="adv2" value="–ì–∞—Ä–∞–Ω—Ç—ñ—è 2 —Ä–æ–∫–∏" placeholder="–¢–µ–∫—Å—Ç –ø–µ—Ä–µ–≤–∞–≥–∏">
                </div>

                <div class="form-group" style="grid-column: 1/-1;">
                  <label>üõçÔ∏è –ü–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä (–Ω–∞–∑–≤–∞)</label>
                  <input type="text" id="product1" value="3D –ü—Ä–∏–Ω—Ç–µ—Ä FDM Pro Max" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä–∞">
                </div>

                <div class="form-group" style="grid-column: 1/-1;">
                  <label>üõçÔ∏è –ü–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä (—Ü—ñ–Ω–∞, –≤ –≥—Ä–Ω)</label>
                  <input type="text" id="product1Price" value="8 500" placeholder="–¶—ñ–Ω–∞">
                </div>

                <button type="button" class="btn" style="grid-column: 1/-1; font-size: 1.1em; padding: 15px;" onclick="generateCustom()">
                  ‚ú® –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –º—ñ–π –ª–µ–Ω–¥—ñ–Ω–≥!
                </button>
              </form>
            </div>
          </div>

          <div id="json" class="tab-content">
            <div class="content">
            <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
            <div class="card">
              <h2>‚ö° –®–≤–∏–¥–∫–∏–π –∑–∞–ø—É—Å–∫</h2>
              <div class="info-box">
                <p><strong>–í–∞—Ä—ñ–∞–Ω—Ç 1:</strong> –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ñ –¥–∞–Ω—ñ</p>
              </div>
              <form action="/generate" method="GET">
                <button type="submit" class="btn" style="width: 100%;">
                  ‚úì –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
                </button>
              </form>

              <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">

              <div class="info-box">
                <p><strong>–í–∞—Ä—ñ–∞–Ω—Ç 2:</strong> –ü–µ—Ä–µ–¥–∞–π—Ç–µ JSON –∑ –≤–ª–∞—Å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏</p>
              </div>
              <form action="/generate" method="POST" id="jsonForm">
                <div class="form-group">
                  <label>JSON –¥–∞–Ω—ñ (–∞–±–æ —Ä–µ–¥–∞–≥—É–π—Ç–µ –Ω–∏–∂—á–µ)</label>
                  <textarea id="jsonData" name="jsonData">${JSON.stringify(defaultData, null, 2)}</textarea>
                </div>
                <button type="button" class="btn btn-secondary" onclick="resetJSON()">–°–∫–∏–Ω—É—Ç–∏</button>
                <button type="submit" class="btn" style="width: 100%;">
                  ‚Üí –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑ JSON
                </button>
              </form>
            </div>

            <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
            <div class="card">
              <h2>üìã –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>

              <div class="info-box">
                <h3>–î–æ—Å—Ç—É–ø–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏:</h3>
              </div>
              <div class="route">GET /api/data</div>
              <p style="margin-bottom: 10px;">–ü–æ–≤–µ—Ä—Ç–∞—î JSON –¥–∞–Ω—ñ</p>

              <div class="route">GET /api/status</div>
              <p style="margin-bottom: 20px;">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</p>

              <div class="route">GET /generate</div>
              <p style="margin-bottom: 10px;">–ì–µ–Ω–µ—Ä—É—î HTML –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö</p>

              <div class="route">POST /generate</div>
              <p style="margin-bottom: 20px;">–ì–µ–Ω–µ—Ä—É—î HTML –∑ –ø–µ—Ä–µ–¥–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö (JSON body)</p>

              <div class="info-box">
                <h3>–°—Ç—Ä—É—Ç—É—Ä–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö:</h3>
                <ul style="margin-left: 20px; color: #555;">
                  <li>5 —Ç–æ–≤–∞—Ä—ñ–≤</li>
                  <li>5 –ø–µ—Ä–µ–≤–∞–≥</li>
                  <li>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ñ –±—Ä–µ–Ω–¥—É</li>
                  <li>Hero —Å–µ–∫—Ü—ñ—è</li>
                  <li>–ü–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—Ä–æ–¥—É–∫—Ç–∏</li>
                </ul>
              </div>
            </div>
            </div>
          </div>

          <div id="info" class="tab-content">
            <div class="card">
              <h2>üìã –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h2>
              <div style="line-height: 1.8; color: #555;">
                <h3 style="margin-top: 20px;">üìù –í–∫–ª–∞–¥–∏–Ω–∫–∞ "–ü—Ä–æ—Å—Ç–æ"</h3>
                <p>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø—Ä–æ—Å—Ç—É —Ñ–æ—Ä–º—É - –Ω–∞–ø–∏—à—ñ—Ç—å —Ç–µ–∫—Å—Ç, —Ü—ñ–Ω–∏, –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ.</p>
                <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏" - –æ—Ç—Ä–∏–º–∞—î—Ç–µ –≥–æ—Ç–æ–≤–∏–π —Å–∞–π—Ç.</p>

                <h3 style="margin-top: 20px;">üíª –í–∫–ª–∞–¥–∏–Ω–∫–∞ "JSON"</h3>
                <p>–î–ª—è –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏—Ö: —Ä–µ–¥–∞–≥—É–π—Ç–µ JSON –¥–∞–Ω—ñ —Ç–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ñ –¥–∞–Ω—ñ.</p>
                <p>–í–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤—Å–µ —â–æ –∑–∞–≤–≥–æ–¥–Ω–æ.</p>

                <h3 style="margin-top: 20px;">üì∏ –§–æ—Ç–æ —ñ –í—ñ–¥–µ–æ</h3>
                <p><strong>–§–æ—Ç–æ:</strong> –í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (JPG, PNG, WebP)</p>
                <p>–ü—Ä–∏–∫–ª–∞–¥: <code>https://example.com/photo.jpg</code></p>
                <p style="margin-top: 10px;"><strong>–í—ñ–¥–µ–æ:</strong> –í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ MP4 –≤—ñ–¥–µ–æ</p>
                <p>–ü—Ä–∏–∫–ª–∞–¥: <code>https://example.com/video.mp4</code></p>

                <h3 style="margin-top: 20px;">‚ú® –õ–æ–∫–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏</h3>
                <p>–ó–∞—Ä–∞–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ª–æ–∫–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏ (img/, video/).</p>
                <p>–©–æ–± –∑–º—ñ–Ω–∏—Ç–∏, –≤–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π —à–ª—è—Ö –∞–±–æ URL.</p>

                <h3 style="margin-top: 20px;">üéØ –ü—Ä–∏–∫–ª–∞–¥ –ø–æ—Å–∏–ª–∞–Ω—å:</h3>
                <ul style="margin-left: 20px;">
                  <li><code>img/products/my-photo.jpg</code> - –ª–æ–∫–∞–ª—å–Ω–µ —Ñ–æ—Ç–æ</li>
                  <li><code>https://unsplash.com/photos/abc.jpg</code> - —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç —Ñ–æ—Ç–æ</li>
                  <li><code>video/my-video.mp4</code> - –ª–æ–∫–∞–ª—å–Ω–µ –≤—ñ–¥–µ–æ</li>
                  <li><code>https://example.com/video.mp4</code> - —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—ñ–¥–µ–æ</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <script>
          // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
          function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ
            document.querySelectorAll('.tab-content').forEach(tab => {
              tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
              btn.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
          }

          // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ª–µ–Ω–¥–∏–Ω–≥–∞ (–∏–∑ –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º—ã)
          function generateCustom() {
            const customData = ${JSON.stringify(defaultData)};

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
            customData.metadata.brand = document.getElementById('brand').value;
            customData.hero.title = document.getElementById('heroTitle').value;
            customData.hero.price = document.getElementById('price').value;
            customData.hero.image = document.getElementById('heroImage').value;
            customData.hero.image_mobile = document.getElementById('heroImage').value;

            customData.promo.video = document.getElementById('videoUrl').value;
            customData.promo.thumbnail_desktop = document.getElementById('videoThumbnail').value;
            customData.promo.thumbnail_mobile = document.getElementById('videoThumbnail').value;

            // –ü–µ—Ä–µ–≤–∞–≥–∏
            if (document.getElementById('adv1').value) {
              customData.advantages[0].title = document.getElementById('adv1').value;
            }
            if (document.getElementById('adv2').value) {
              customData.advantages[1].title = document.getElementById('adv2').value;
            }

            // –¢–æ–≤–∞—Ä–∏
            if (document.getElementById('product1').value) {
              customData.products.items[0].name = document.getElementById('product1').value;
            }
            if (document.getElementById('product1Price').value) {
              customData.products.items[0].price_new = document.getElementById('product1Price').value;
            }

            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ POST –∑–∞–ø–∏—Ç
            fetch('/generate', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(customData)
            })
            .then(response => response.text())
            .then(html => {
              const blob = new Blob([html], { type: 'text/html' });
              const url = window.URL.createObjectURL(blob);
              window.open(url, '_blank');
            })
            .catch(err => alert('–ü–æ–º–∏–ª–∫–∞: ' + err.message));
          }

          function resetJSON() {
            if (confirm('–°–∫–∏–Ω—É—Ç–∏ JSON –¥–æ –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å?')) {
              document.getElementById('jsonData').value = ${JSON.stringify(JSON.stringify(defaultData, null, 2))};
            }
          }

          document.getElementById('jsonForm').addEventListener('submit', function(e) {
            e.preventDefault();

            try {
              const jsonStr = document.getElementById('jsonData').value;
              const data = JSON.parse(jsonStr);

              // –ù–∞–¥—Å–∏–ª–∞—î–º–æ POST –∑–∞–ø–∏—Ç
              fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              })
              .then(response => response.text())
              .then(html => {
                const blob = new Blob([html], { type: 'text/html' });
                const url = window.URL.createObjectURL(blob);
                window.open(url, '_blank');
              })
              .catch(err => alert('–ü–æ–º–∏–ª–∫–∞: ' + err.message));
            } catch (err) {
              alert('–ù–µ–≤—ñ—Ä–Ω–∏–π JSON: ' + err.message);
            }
          });
        </script>
      </body>
      </html>
    `);
  } catch (error) {
    res.status(500).send('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏: ' + error.message);
  }
});

// GET /api/data - –û—Ç—Ä–∏–º–∞—Ç–∏ JSON –¥–∞–Ω—ñ
app.get('/api/data', (req, res) => {
  try {
    const dataPath = path.join(__dirname, 'data', 'landing-data.json');
    const data = JSON.parse(fs.readFileSync(dataPath, 'utf-8'));
    res.json({
      success: true,
      data: data
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// GET /api/status - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
app.get('/api/status', (req, res) => {
  res.json({
    status: 'OK',
    server: 'Running',
    port: PORT,
    timestamp: new Date().toISOString(),
    tests: {
      'Express': 'PASS',
      'EJS': 'PASS',
      'JSON Data': 'PASS',
      'Static Files': 'PASS'
    }
  });
});

// GET /generate - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–∞–π—Ç—É –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ (–¢–ï–°–¢–£–í–ê–ù–ù–Ø)
app.get('/generate', (req, res) => {
  try {
    const dataPath = path.join(__dirname, 'data', 'landing-data.json');
    const data = JSON.parse(fs.readFileSync(dataPath, 'utf-8'));

    console.log('\n‚úì –¢–ï–°–¢: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML');
    console.log(`  ‚úÖ JSON –ø—Ä–æ—á–∏—Ç–∞–Ω–∏–π`);
    console.log(`  ‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ template.ejs`);

    res.render('template', { data: data }, (err, html) => {
      if (err) {
        console.log(`  ‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ–Ω–¥–µ—Ä—É: ${err.message}`);
        res.status(500).json({
          success: false,
          error: err.message
        });
      } else {
        console.log(`  ‚úÖ HTML –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π (${html.length} bytes)`);
        console.log(`  ‚úÖ –£—Å—ñ –∑–º—ñ–Ω–Ω—ñ –ø—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω—ñ\n`);

        // –ü–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —â–æ –∑–º—ñ–Ω–Ω—ñ –ø—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω—ñ
        const checks = {
          'Has title': html.includes('<title>'),
          'Has hero': html.includes('–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ 3D –ø—Ä–∏–Ω—Ç–µ—Ä–∏') || html.includes('title-xl'),
          'Has price': html.includes('8 500'),
          'Has products': html.includes('products-text_title'),
          'Has advantages': html.includes('plus-list'),
          'CSS loaded': html.includes('css/main.css'),
          'JS loaded': html.includes('js/main.js')
        };

        console.log('‚úì –ü–ï–†–ï–í–Ü–†–ö–ê HTML:');
        Object.entries(checks).forEach(([name, pass]) => {
          console.log(`  ${pass ? '‚úÖ' : '‚ùå'} ${name}`);
        });

        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ HTML
        res.send(html);
      }
    });
  } catch (error) {
    console.log(`  ‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// POST /generate - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–∞–π—Ç—É –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏
app.post('/generate', (req, res) => {
  try {
    const customData = req.body;

    console.log('\n‚úì POST /generate: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏');
    console.log(`  ‚úÖ –û—Ç—Ä–∏–º–∞–Ω–æ –¥–∞–Ω—ñ`);
    console.log(`  ‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ template.ejs`);

    res.render('template', { data: customData }, (err, html) => {
      if (err) {
        console.log(`  ‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ–Ω–¥–µ—Ä—É: ${err.message}`);
        res.status(500).json({
          success: false,
          error: err.message
        });
      } else {
        console.log(`  ‚úÖ HTML –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π (${html.length} bytes)`);
        console.log(`  ‚úÖ –¢–æ–≤–∞—Ä—ñ–≤ —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ: ${customData.products?.items?.length || 0}\n`);
        res.send(html);
      }
    });
  } catch (error) {
    console.log(`  ‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(PORT, () => {
  console.log('\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
  console.log(`‚úÖ –°–ï–†–í–ï–† –ó–ê–ü–£–©–ï–ù–ò–ô –ù–ê –ü–û–†–¢–£ ${PORT}`);
  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
  console.log('–ê–¥—Ä–µ—Å–∞:');
  console.log(`  üîó http://localhost:${PORT}/\n`);
  console.log('–ú–∞—Ä—à—Ä—É—Ç–∏:');
  console.log(`  ‚Ä¢ http://localhost:${PORT}/api/data - JSON –¥–∞–Ω—ñ`);
  console.log(`  ‚Ä¢ http://localhost:${PORT}/api/status - –°—Ç–∞—Ç—É—Å\n`);
  console.log('–î–ª—è –∑—É–ø–∏–Ω–∫–∏ –Ω–∞—Ç–∏—Å–Ω–∏ CTRL+C\n');
});

// –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
process.on('uncaughtException', (error) => {
  console.error('–ü–æ–º–∏–ª–∫–∞:', error);
  process.exit(1);
});
